{"version":3,"sources":["controllers/japari-controller.js"],"names":["JapariController","Route","get","post","botErrorReporter","main","allEvent","request","fromBot","body","type","QQService","convertMessageType","plugins","PluginService","getPlugins","config","getConfig","plugin","name","go"],"mappings":"kRAAA;AACA;AACA;AACA,2E;;;AAGMA,gB,WADL,qB;AAEEC,cAAMC,GAAN,CAAU,GAAV,C;;;;;AAKAD,cAAME,IAAN,CAAW,QAAX,EAAqBC,yBAArB,C,2BAPH,MACMJ,gBADN,CACuB,CAErBK,IADA,GACO,CACL,OAAO,6EAAP,CACD;AAGKC,EAAAA,QADN,CACe,EAAEC,OAAF,EADf,EAC4B;AAC1B,YAAMC,OAAO,GAAGD,OAAO,CAACE,IAAxB;AACA,YAAMC,IAAI,GAAGC,mBAAUC,kBAAV,CAA6BJ,OAA7B,CAAb;AACA,YAAMK,OAAO,GAAGC,uBAAcC,UAAd,CAAyBL,IAAzB,CAAhB;AACA,YAAMM,MAAM,GAAGF,uBAAcG,SAAd,CAAwBP,IAAxB,EAA8BF,OAA9B,CAAf;AACA,UAAI,CAACQ,MAAL,EAAa,OAAO,EAAP;AACb;AAN0B,6GAO1B,qBAAqBH,OAArB,8HAA8B,OAAnBK,MAAmB;AAC5B,cAAI,CAACF,MAAM,CAACE,MAAM,CAACC,IAAR,CAAX,EAA0B;AAC1B,cAAI,OAAOD,MAAM,CAACE,EAAP,CAAUZ,OAAV,EAAmBE,IAAnB,CAAP,MAAqC,OAAzC,EAAkD;AACnD,SAVyB;AAW1B,aAAO,EAAP,CAX0B;AAY3B,GAnBoB,C;;;AAsBRV,gB","sourcesContent":["import { Router, Route } from '../decorators/router';\nimport botErrorReporter from '../middlewares/bot-error-reporter';\nimport PluginService from '../services/plugin-service';\nimport QQService from '../services/qq-service';\n\n@Router()\nclass JapariController {\n  @Route.get('/')\n  main() {\n    return \"<h1>ようこそ！ジャパリパークへ！</h1><script>console.log('/japari/event is bot')</script>\";\n  }\n\n  @Route.post('/event', botErrorReporter)\n  async allEvent({ request }) {\n    const fromBot = request.body;\n    const type = QQService.convertMessageType(fromBot);\n    const plugins = PluginService.getPlugins(type);\n    const config = PluginService.getConfig(type, fromBot);\n    if (!config) return {};\n    // eslint-disable-next-line no-restricted-syntax\n    for (const plugin of plugins) {\n      if (!config[plugin.name]) continue;\n      if ((await plugin.go(fromBot, type)) === 'break') break;\n    }\n    return {};\n  }\n}\n\nexport default JapariController;\n"],"file":"japari-controller.js","sourceRoot":"/Users/zcwsr/my/japari-admin/src"}